<div class="min-h-screen flex flex-col items-center p-4 sm:p-6 md:p-8">
  <header class="w-full max-w-4xl text-center mb-8">
    <h1 class="text-4xl sm:text-5xl font-bold text-white mb-2 tracking-tight">
      {{ 'headerTitle' | translate }} <span class="text-brand-secondary">{{ 'headerTitleSpan' | translate }}</span>
    </h1>
    <p class="text-lg text-brand-subtle">
      {{ 'headerSubtitle' | translate }}
    </p>
  </header>

  <main class="w-full max-w-4xl flex-grow flex flex-col">
    <div class="bg-brand-surface p-6 rounded-lg shadow-2xl flex flex-col gap-4">
      
      <div>
        <label for="language-select" class="text-lg font-semibold text-brand-text">{{ 'formLabelLanguage' | translate }}</label>
        <select
          id="language-select"
          [ngModel]="selectedLang()" (ngModelChange)="selectedLang.set($event)"
          class="mt-2 w-full p-3 bg-brand-primary border border-brand-primary rounded-md focus:ring-2 focus:ring-brand-secondary focus:outline-none transition-shadow text-brand-text"
        >
          @for (lang of availableLangs; track lang.code) {
            <option [value]="lang.code">{{ lang.name }}</option>
          }
        </select>
      </div>

      <div>
        <label for="story-idea" class="text-lg font-semibold text-brand-text">{{ 'formLabelStoryIdea' | translate }}</label>
        <textarea
          id="story-idea"
          [(ngModel)]="storyIdea"
          rows="5"
          class="mt-2 w-full p-3 bg-brand-primary border border-brand-primary rounded-md focus:ring-2 focus:ring-brand-secondary focus:outline-none transition-shadow text-brand-text placeholder-brand-subtle"
          [placeholder]="'formPlaceholderStoryIdea' | translate"
        ></textarea>
      </div>

      <div>
        <label for="tone-select" class="text-lg font-semibold text-brand-text">{{ 'formLabelTone' | translate }}</label>
        <select
          id="tone-select"
          [(ngModel)]="selectedTone"
          class="mt-2 w-full p-3 bg-brand-primary border border-brand-primary rounded-md focus:ring-2 focus:ring-brand-secondary focus:outline-none transition-shadow text-brand-text"
        >
          @for (tone of tones; track tone.key) {
            <option [value]="tone.key">{{ 'tones.' + tone.key | translate }}</option>
          }
        </select>
      </div>

      <div>
        <label for="model-select" class="text-lg font-semibold text-brand-text">{{ 'formLabelModel' | translate }}</label>
        <select
          id="model-select"
          [(ngModel)]="selectedModel"
          class="mt-2 w-full p-3 bg-brand-primary border border-brand-primary rounded-md focus:ring-2 focus:ring-brand-secondary focus:outline-none transition-shadow text-brand-text"
        >
          @for (model of models; track model) {
            <option [value]="model">{{ model }}</option>
          }
        </select>
      </div>

      <button
        (click)="generateScript()"
        [disabled]="isLoading() || !storyIdea()"
        class="w-full sm:w-auto self-end px-8 py-3 bg-brand-secondary text-white font-bold rounded-md hover:bg-red-500 transition-colors duration-300 disabled:bg-gray-500 disabled:cursor-not-allowed flex items-center justify-center gap-2 mt-2"
      >
        @if (isLoading()) {
          <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span>{{ 'buttonGenerating' | translate }}</span>
        } @else {
          <span>{{ 'buttonGenerate' | translate }}</span>
        }
      </button>
    </div>

    @if (error()) {
      <div class="mt-8 bg-red-900 border border-red-700 text-red-200 px-4 py-3 rounded-lg relative" role="alert">
        <strong class="font-bold">{{ 'errorPrefix' | translate }} </strong>
        <span class="block sm:inline">{{ error() }}</span>
      </div>
    }

    @if (generatedScript() && !isLoading()) {
      <div class="mt-8 bg-brand-surface p-6 rounded-lg shadow-2xl flex-grow flex flex-col">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold text-white">{{ 'scriptHeader' | translate }}</h2>
          <div class="flex items-center gap-2">
            <button 
              (click)="copyToClipboard()"
              class="px-4 py-2 bg-brand-primary text-brand-text font-semibold rounded-md hover:bg-[#1e4a8a] transition-colors duration-300 flex items-center gap-2"
              title="Copy to clipboard">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              <span>{{ copyButtonText() }}</span>
            </button>
            <button 
              (click)="downloadScript()"
              class="px-4 py-2 bg-brand-primary text-brand-text font-semibold rounded-md hover:bg-[#1e4a8a] transition-colors duration-300 flex items-center gap-2"
              title="Download as .txt">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
              <span>{{ 'downloadButtonText' | translate }}</span>
            </button>
          </div>
        </div>
        <div class="h-96 overflow-y-auto bg-brand-bg p-4 rounded-md border border-brand-primary text-brand-text">
          <pre class="whitespace-pre-wrap font-mono text-sm leading-relaxed">{{ generatedScript() }}</pre>
        </div>
      </div>
    } @else if (isLoading()) {
      <div class="mt-8 bg-brand-surface p-6 rounded-lg shadow-2xl flex-grow flex flex-col items-center justify-center text-center">
        <svg class="animate-spin h-10 w-10 text-brand-secondary mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <h2 class="text-2xl font-bold text-white">{{ 'loadingTitle' | translate }}</h2>
        <p class="text-brand-subtle mt-2">{{ 'loadingSubtitle' | translate }}</p>
      </div>
    }
  </main>
</div>